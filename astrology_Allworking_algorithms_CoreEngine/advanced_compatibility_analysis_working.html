<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Compatibility Analysis System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #2B3990 0%, #454FBF 100%);
            min-height: 100vh;
            color: #fff;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            color: #F5A623;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .form-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .person-form {
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .person-form h2 {
            color: #F5A623;
            margin-bottom: 20px;
            font-size: 1.5em;
            text-align: center;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #fff;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .location-container {
            position: relative;
        }

        .location-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            display: none;
        }

        .location-suggestion {
            padding: 10px;
            cursor: pointer;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            color: #333;
            transition: background 0.3s ease;
        }

        .location-suggestion:hover {
            background: rgba(245, 166, 35, 0.2);
        }

        .coordinates-display {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
            font-style: italic;
        }

        .ai-analysis {
            background: linear-gradient(135deg, rgba(245, 166, 35, 0.1), rgba(245, 166, 35, 0.05));
            border: 1px solid rgba(245, 166, 35, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .ai-analysis h3 {
            color: #F5A623;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ai-badge {
            background: #F5A623;
            color: #fff;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: bold;
        }

        .scientific-explanation {
            background: rgba(255, 255, 255, 0.1);
            border-left: 4px solid #F5A623;
            padding: 15px;
            margin-top: 10px;
            border-radius: 5px;
        }

        .scientific-explanation h5 {
            color: #F5A623;
            margin-bottom: 8px;
            font-size: 0.9em;
        }

        .scientific-explanation p {
            font-size: 0.9em;
            line-height: 1.4;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            box-shadow: 0 0 15px rgba(245, 166, 35, 0.5);
            transform: translateY(-2px);
        }

        .relationship-type {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }

        .relationship-type h3 {
            color: #F5A623;
            margin-bottom: 15px;
            text-align: center;
        }

        .relationship-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .relationship-option {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            text-align: center;
        }

        .relationship-option:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-3px);
        }

        .relationship-option.selected {
            border-color: #F5A623;
            background: rgba(245, 166, 35, 0.2);
        }

        .analyze-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(45deg, #F5A623, #FFD700);
            color: #333;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 30px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .analyze-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(245, 166, 35, 0.3);
        }

        .analyze-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .results {
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            display: none;
        }

        .results.show {
            display: block;
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .compatibility-score {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(245, 166, 35, 0.1);
            border-radius: 10px;
        }

        .score-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: conic-gradient(#F5A623 0deg, #F5A623 var(--score-deg), rgba(255,255,255,0.2) var(--score-deg), rgba(255,255,255,0.2) 360deg);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            position: relative;
        }

        .score-circle::after {
            content: '';
            width: 90px;
            height: 90px;
            border-radius: 50%;
            background: rgba(43, 57, 144, 0.9);
            position: absolute;
        }

        .score-text {
            position: relative;
            z-index: 1;
            font-size: 2em;
            font-weight: bold;
            color: #F5A623;
        }

        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .analysis-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #F5A623;
        }

        .analysis-card h4 {
            color: #F5A623;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #F5A623, #FFD700);
            transition: width 0.5s ease;
        }

        .vedic-analysis {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .vedic-factors {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .vedic-factor {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .planetary-aspects {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .aspect-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #F5A623;
        }

        .recommendations {
            background: rgba(245, 166, 35, 0.1);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid rgba(245, 166, 35, 0.3);
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2em;
            color: #F5A623;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(245, 166, 35, 0.3);
            border-top: 4px solid #F5A623;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .form-container {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .relationship-options {
                grid-template-columns: 1fr;
            }
            
            .analysis-grid {
                grid-template-columns: 1fr;
            }
            
            .vedic-factors {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Advanced Compatibility Analysis</h1>
            <p>Swiss Ephemeris • ML Predictions • Vedic Kundli Milan</p>
        </div>

        <div class="form-container">
            <div class="person-form">
                <h2>Person 1 Details</h2>
                <div class="form-group">
                    <label for="name1">Full Name</label>
                    <input type="text" id="name1" placeholder="Enter full name">
                </div>
                <div class="form-group">
                    <label for="birthdate1">Birth Date</label>
                    <input type="date" id="birthdate1">
                </div>
                <div class="form-group">
                    <label for="birthtime1">Birth Time</label>
                    <input type="time" id="birthtime1">
                </div>
                <div class="form-group">
                    <label for="birthplace1">Birth Place</label>
                    <div class="location-container">
                        <input type="text" id="birthplace1" placeholder="Start typing city name..." autocomplete="off">
                        <div class="location-suggestions" id="suggestions1"></div>
                        <div class="coordinates-display" id="coords1"></div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="gender1">Gender</label>
                    <select id="gender1">
                        <option value="">Select Gender</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                        <option value="other">Other</option>
                    </select>
                </div>
            </div>

            <div class="person-form">
                <h2>Person 2 Details</h2>
                <div class="form-group">
                    <label for="name2">Full Name</label>
                    <input type="text" id="name2" placeholder="Enter full name">
                </div>
                <div class="form-group">
                    <label for="birthdate2">Birth Date</label>
                    <input type="date" id="birthdate2">
                </div>
                <div class="form-group">
                    <label for="birthtime2">Birth Time</label>
                    <input type="time" id="birthtime2">
                </div>
                <div class="form-group">
                    <label for="birthplace2">Birth Place</label>
                    <div class="location-container">
                        <input type="text" id="birthplace2" placeholder="Start typing city name..." autocomplete="off">
                        <div class="location-suggestions" id="suggestions2"></div>
                        <div class="coordinates-display" id="coords2"></div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="gender2">Gender</label>
                    <select id="gender2">
                        <option value="">Select Gender</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                        <option value="other">Other</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="relationship-type">
            <h3>Relationship Type</h3>
            <div class="relationship-options">
                <div class="relationship-option" data-type="marriage">
                    <h4>Marriage</h4>
                    <p>Long-term commitment analysis</p>
                </div>
                <div class="relationship-option" data-type="dating">
                    <h4>Dating</h4>
                    <p>Romantic compatibility focus</p>
                </div>
                <div class="relationship-option" data-type="business">
                    <h4>Business Partnership</h4>
                    <p>Professional collaboration</p>
                </div>
                <div class="relationship-option" data-type="friendship">
                    <h4>Friendship</h4>
                    <p>Platonic relationship compatibility</p>
                </div>
            </div>
        </div>

        <button class="analyze-btn" id="analyzeBtn" disabled>Analyze Compatibility</button>

        <div class="results" id="results">
            <div class="loading" id="loading">
                <div class="loading-spinner"></div>
                <p>Calculating planetary positions and analyzing compatibility...</p>
            </div>

            <div id="analysisResults" style="display: none;">
                <div class="ai-analysis">
                    <h3>
                        🤖 AI Deep Analysis 
                        <span class="ai-badge">OLLAMA</span>
                    </h3>
                    <div id="aiInsights">
                        <p>Advanced AI analysis processing...</p>
                    </div>
                </div>

                <div class="compatibility-score">
                    <div class="score-circle" id="scoreCircle">
                        <div class="score-text" id="scoreText">0%</div>
                    </div>
                    <h3 id="compatibilityLevel">Calculating...</h3>
                </div>

                <div class="analysis-grid">
                    <div class="analysis-card">
                        <h4>Emotional Compatibility</h4>
                        <div class="progress-bar">
                            <div class="progress-fill" id="emotionalProgress"></div>
                        </div>
                        <p id="emotionalText">Analyzing emotional connection...</p>
                    </div>

                    <div class="analysis-card">
                        <h4>Intellectual Compatibility</h4>
                        <div class="progress-bar">
                            <div class="progress-fill" id="intellectualProgress"></div>
                        </div>
                        <p id="intellectualText">Analyzing mental connection...</p>
                    </div>

                    <div class="analysis-card">
                        <h4>Physical Compatibility</h4>
                        <div class="progress-bar">
                            <div class="progress-fill" id="physicalProgress"></div>
                        </div>
                        <p id="physicalText">Analyzing physical attraction...</p>
                    </div>

                    <div class="analysis-card">
                        <h4>Spiritual Compatibility</h4>
                        <div class="progress-bar">
                            <div class="progress-fill" id="spiritualProgress"></div>
                        </div>
                        <p id="spiritualText">Analyzing spiritual connection...</p>
                    </div>
                </div>

                <div class="vedic-analysis">
                    <h3 style="color: #F5A623; margin-bottom: 15px;">Vedic Kundli Milan Analysis</h3>
                    <div class="vedic-factors">
                        <div class="vedic-factor">
                            <h4>Varna (1/1)</h4>
                            <p id="varnaScore">0</p>
                        </div>
                        <div class="vedic-factor">
                            <h4>Vashya (2/2)</h4>
                            <p id="vashyaScore">0</p>
                        </div>
                        <div class="vedic-factor">
                            <h4>Tara (3/3)</h4>
                            <p id="taraScore">0</p>
                        </div>
                        <div class="vedic-factor">
                            <h4>Yoni (4/4)</h4>
                            <p id="yoniScore">0</p>
                        </div>
                        <div class="vedic-factor">
                            <h4>Gana (6/6)</h4>
                            <p id="ganaScore">0</p>
                        </div>
                        <div class="vedic-factor">
                            <h4>Bhakoot (7/7)</h4>
                            <p id="bhakootScore">0</p>
                        </div>
                        <div class="vedic-factor">
                            <h4>Nadi (8/8)</h4>
                            <p id="nadiScore">0</p>
                        </div>
                        <div class="vedic-factor">
                            <h4>Rajju (5/5)</h4>
                            <p id="rajjuScore">0</p>
                        </div>
                    </div>
                    <div style="text-align: center; margin-top: 20px;">
                        <h4>Total Vedic Score: <span id="totalVedicScore">0/36</span></h4>
                    </div>
                </div>

                <div class="planetary-aspects">
                    <h3 style="color: #F5A623; margin-bottom: 15px;">Planetary Aspect Analysis</h3>
                    <div id="planetaryAspects"></div>
                </div>

                <div class="recommendations">
                    <h3 style="color: #F5A623; margin-bottom: 15px;">Compatibility Insights & Recommendations</h3>
                    <div id="recommendationsList"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let selectedRelationshipType = '';
        let locationCache = {};
        let formData = {
            person1: { coordinates: null },
            person2: { coordinates: null }
        };

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeEventListeners();
            initializeLocationSearch();
            updateAnalyzeButton();
        });

        function initializeLocationSearch() {
            const birthplaceInputs = ['birthplace1', 'birthplace2'];
            
            birthplaceInputs.forEach(inputId => {
                const input = document.getElementById(inputId);
                const suggestionsDiv = document.getElementById(inputId.replace('birthplace', 'suggestions'));
                
                input.addEventListener('input', debounce((e) => {
                    const query = e.target.value.trim();
                    if (query.length > 2) {
                        searchLocations(query, inputId);
                    } else {
                        suggestionsDiv.style.display = 'none';
                    }
                }, 300));
                
                input.addEventListener('blur', () => {
                    setTimeout(() => {
                        suggestionsDiv.style.display = 'none';
                    }, 150);
                });
            });
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        async function searchLocations(query, inputId) {
            const suggestionsDiv = document.getElementById(inputId.replace('birthplace', 'suggestions'));
            
            try {
                // Using OpenStreetMap Nominatim API for free geocoding
                const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}&limit=5&addressdetails=1`);
                const locations = await response.json();
                
                displayLocationSuggestions(locations, inputId);
            } catch (error) {
                console.error('Location search error:', error);
                // Fallback to major cities database
                displayFallbackSuggestions(query, inputId);
            }
        }

        function displayLocationSuggestions(locations, inputId) {
            const suggestionsDiv = document.getElementById(inputId.replace('birthplace', 'suggestions'));
            suggestionsDiv.innerHTML = '';
            
            if (locations.length === 0) {
                suggestionsDiv.style.display = 'none';
                return;
            }
            
            locations.forEach(location => {
                const suggestionDiv = document.createElement('div');
                suggestionDiv.className = 'location-suggestion';
                suggestionDiv.innerHTML = `
                    <div><strong>${location.display_name}</strong></div>
                    <div style="font-size: 11px; color: #666;">
                        Lat: ${parseFloat(location.lat).toFixed(4)}, Lon: ${parseFloat(location.lon).toFixed(4)}
                    </div>
                `;
                
                suggestionDiv.addEventListener('click', () => {
                    selectLocation(location, inputId);
                });
                
                suggestionsDiv.appendChild(suggestionDiv);
            });
            
            suggestionsDiv.style.display = 'block';
        }

        function displayFallbackSuggestions(query, inputId) {
            const majorCities = [
                { name: 'New York, USA', lat: 40.7128, lon: -74.0060 },
                { name: 'London, UK', lat: 51.5074, lon: -0.1278 },
                { name: 'Tokyo, Japan', lat: 35.6762, lon: 139.6503 },
                { name: 'Mumbai, India', lat: 19.0760, lon: 72.8777 },
                { name: 'Paris, France', lat: 48.8566, lon: 2.3522 },
                { name: 'Sydney, Australia', lat: -33.8688, lon: 151.2093 }
            ];
            
            const filtered = majorCities.filter(city => 
                city.name.toLowerCase().includes(query.toLowerCase())
            );
            
            const suggestionsDiv = document.getElementById(inputId.replace('birthplace', 'suggestions'));
            suggestionsDiv.innerHTML = '';
            
            filtered.forEach(city => {
                const suggestionDiv = document.createElement('div');
                suggestionDiv.className = 'location-suggestion';
                suggestionDiv.innerHTML = `
                    <div><strong>${city.name}</strong></div>
                    <div style="font-size: 11px; color: #666;">
                        Lat: ${city.lat}, Lon: ${city.lon}
                    </div>
                `;
                
                suggestionDiv.addEventListener('click', () => {
                    selectLocation({ display_name: city.name, lat: city.lat, lon: city.lon }, inputId);
                });
                
                suggestionsDiv.appendChild(suggestionDiv);
            });
            
            if (filtered.length > 0) {
                suggestionsDiv.style.display = 'block';
            }
        }

        function selectLocation(location, inputId) {
            const input = document.getElementById(inputId);
            const coordsDiv = document.getElementById(inputId.replace('birthplace', 'coords'));
            const suggestionsDiv = document.getElementById(inputId.replace('birthplace', 'suggestions'));
            
            input.value = location.display_name;
            coordsDiv.textContent = `📍 ${parseFloat(location.lat).toFixed(4)}°N, ${parseFloat(location.lon).toFixed(4)}°E`;
            suggestionsDiv.style.display = 'none';
            
            // Store coordinates in form data
            const person = inputId.includes('1') ? 'person1' : 'person2';
            formData[person].coordinates = {
                lat: parseFloat(location.lat),
                lon: parseFloat(location.lon),
                location: location.display_name
            };
            
            updateAnalyzeButton();
        }

        // Enhanced AI Analysis with Ollama Integration
        async function generateAIInsights(person1Data, person2Data, relationshipType, compatibilityScores) {
            const aiInsightsDiv = document.getElementById('aiInsights');
            aiInsightsDiv.innerHTML = '<p>🤖 Generating AI insights...</p>';
            
            try {
                // Simulate Ollama API call
                const aiAnalysis = await simulateOllamaAnalysis({
                    person1: person1Data,
                    person2: person2Data,
                    relationshipType,
                    scores: compatibilityScores
                });
                
                aiInsightsDiv.innerHTML = `
                    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <h4 style="color: #F5A623; margin-bottom: 10px;">🧠 Psychological Compatibility Analysis</h4>
                        <p>${aiAnalysis.psychological}</p>
                    </div>
                    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <h4 style="color: #F5A623; margin-bottom: 10px;">⚡ Energy Pattern Analysis</h4>
                        <p>${aiAnalysis.energyPattern}</p>
                    </div>
                    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px;">
                        <h4 style="color: #F5A623; margin-bottom: 10px;">🎯 Relationship Dynamics Prediction</h4>
                        <p>${aiAnalysis.relationshipDynamics}</p>
                    </div>
                `;
            } catch (error) {
                aiInsightsDiv.innerHTML = '<p>AI analysis temporarily unavailable. Using standard compatibility assessment.</p>';
            }
        }

        async function simulateOllamaAnalysis(data) {
            // Simulate Ollama API response
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            const analyses = {
                psychological: [
                    "Based on birth time analysis, Person 1 exhibits strong analytical tendencies while Person 2 demonstrates intuitive decision-making patterns. This creates a complementary dynamic where logical reasoning balances emotional intelligence.",
                    "The temporal birth patterns suggest Person 1 has peak mental clarity in morning hours, while Person 2 shows enhanced creativity during evening periods. This natural rhythm alignment can foster productive collaboration.",
                    "Psychological compatibility indicators show strong potential for mutual intellectual stimulation, with both individuals displaying curiosity-driven personalities that can inspire continuous learning together."
                ],
                energyPattern: [
                    "The geographic birth coordinates create an interesting energy meridian intersection. Person 1's eastern birth longitude suggests goal-oriented energy, while Person 2's coordinates indicate nurturing, supportive energy patterns.",
                    "Birth location analysis reveals complementary energy frequencies - one partner brings stability and grounding energy, while the other contributes dynamic, transformative energy to the relationship.",
                    "The longitudinal difference in birth places creates a beneficial energy polarity, suggesting natural attraction and the potential for balanced emotional exchanges."
                ],
                relationshipDynamics: [
                    "The relationship type analysis indicates high potential for " + data.relationshipType + " success. Communication patterns suggest both partners can effectively express needs while maintaining respect for individual differences.",
                    "Long-term stability indicators are positive, with both individuals showing capacity for compromise and growth. The partnership dynamic suggests natural role distribution that minimizes conflict and maximizes mutual support.",
                    "Based on compatibility scores, this relationship has strong potential for weathering challenges through effective communication and mutual understanding. Both partners show emotional maturity indicators."
                ]
            };
            
            return {
                psychological: analyses.psychological[Math.floor(Math.random() * analyses.psychological.length)],
                energyPattern: analyses.energyPattern[Math.floor(Math.random() * analyses.energyPattern.length)],
                relationshipDynamics: analyses.relationshipDynamics[Math.floor(Math.random() * analyses.relationshipDynamics.length)]
            };
        }

        function initializeEventListeners() {
            // Form input event listeners
            const inputs = document.querySelectorAll('input, select');
            inputs.forEach(input => {
                input.addEventListener('input', handleInputChange);
                input.addEventListener('change', handleInputChange);
            });

            // Relationship type selection
            const relationshipOptions = document.querySelectorAll('.relationship-option');
            relationshipOptions.forEach(option => {
                option.addEventListener('click', function() {
                    relationshipOptions.forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedRelationshipType = this.dataset.type;
                    updateAnalyzeButton();
                });
            });

            // Analyze button
            document.getElementById('analyzeBtn').addEventListener('click', performAnalysis);
        }

        function handleInputChange(event) {
            const id = event.target.id;
            const value = event.target.value;
            
            if (id.includes('1')) {
                const field = id.replace('1', '');
                formData.person1[field] = value;
            } else if (id.includes('2')) {
                const field = id.replace('2', '');
                formData.person2[field] = value;
            }
            
            updateAnalyzeButton();
        }

        function updateAnalyzeButton() {
            const person1Complete = formData.person1.name && formData.person1.birthdate && 
                                  formData.person1.birthtime && formData.person1.birthplace && 
                                  formData.person1.gender;
            const person2Complete = formData.person2.name && formData.person2.birthdate && 
                                  formData.person2.birthtime && formData.person2.birthplace && 
                                  formData.person2.gender;
            
            const analyzeBtn = document.getElementById('analyzeBtn');
            analyzeBtn.disabled = !(person1Complete && person2Complete && selectedRelationshipType);
        }

        function performAnalysis() {
            const resultsDiv = document.getElementById('results');
            const loadingDiv = document.getElementById('loading');
            const analysisDiv = document.getElementById('analysisResults');
            
            // Show results container and loading
            resultsDiv.classList.add('show');
            loadingDiv.style.display = 'block';
            analysisDiv.style.display = 'none';
            
            // Simulate analysis process
            setTimeout(() => {
                calculateCompatibility();
                loadingDiv.style.display = 'none';
                analysisDiv.style.display = 'block';
            }, 3000);
        }

        function calculateCompatibility() {
            // Generate AI insights first
            generateAIInsights(formData.person1, formData.person2, selectedRelationshipType, {});
            
            // Simulate Swiss Ephemeris and ML calculations
            const baseCompatibility = Math.random() * 100;
            const adjustedScore = adjustScoreForRelationshipType(baseCompatibility);
            
            // Update main compatibility score
            updateCompatibilityScore(adjustedScore);
            
            // Calculate individual aspect scores
            const aspects = calculateAspectScores(adjustedScore);
            updateAspectScores(aspects);
            
            // Calculate Vedic scores
            const vedicScores = calculateVedicScores();
            updateVedicScores(vedicScores);
            
            // Generate planetary aspects
            generatePlanetaryAspects();
            
            // Generate recommendations
            generateRecommendations(adjustedScore, aspects);
            
            // Update AI insights with final scores
            setTimeout(() => {
                generateAIInsights(formData.person1, formData.person2, selectedRelationshipType, {
                    overall: adjustedScore,
                    aspects: aspects
                });
            }, 1000);
        }

        function adjustScoreForRelationshipType(baseScore) {
            const adjustments = {
                marriage: 0.95,
                dating: 1.05,
                business: 0.9,
                friendship: 1.1
            };
            
            return Math.min(100, baseScore * adjustments[selectedRelationshipType]);
        }

        function updateCompatibilityScore(score) {
            const scoreCircle = document.getElementById('scoreCircle');
            const scoreText = document.getElementById('scoreText');
            const compatibilityLevel = document.getElementById('compatibilityLevel');
            
            // Update score circle
            const scoreDegree = (score / 100) * 360;
            scoreCircle.style.setProperty('--score-deg', scoreDegree + 'deg');
            
            // Animate score text
            let currentScore = 0;
            const increment = score / 50;
            const timer = setInterval(() => {
                currentScore += increment;
                if (currentScore >= score) {
                    currentScore = score;
                    clearInterval(timer);
                }
                scoreText.textContent = Math.round(currentScore) + '%';
            }, 40);
            
            // Update compatibility level
            if (score >= 80) {
                compatibilityLevel.textContent = 'Excellent Compatibility';
            } else if (score >= 60) {
                compatibilityLevel.textContent = 'Good Compatibility';
            } else if (score >= 40) {
                compatibilityLevel.textContent = 'Average Compatibility';
            } else {
                compatibilityLevel.textContent = 'Challenging Compatibility';
            }
        }

        function calculateAspectScores(overallScore) {
            const baseVariation = 20;
            return {
                emotional: Math.max(0, Math.min(100, overallScore + (Math.random() - 0.5) * baseVariation)),
                intellectual: Math.max(0, Math.min(100, overallScore + (Math.random() - 0.5) * baseVariation)),
                physical: Math.max(0, Math.min(100, overallScore + (Math.random() - 0.5) * baseVariation)),
                spiritual: Math.max(0, Math.min(100, overallScore + (Math.random() - 0.5) * baseVariation))
            };
        }

        function updateAspectScores(aspects) {
            const aspectData = {
                emotional: {
                    score: aspects.emotional,
                    text: getEmotionalText(aspects.emotional),
                    scientific: getEmotionalScientificExplanation(aspects.emotional)
                },
                intellectual: {
                    score: aspects.intellectual,
                    text: getIntellectualText(aspects.intellectual),
                    scientific: getIntellectualScientificExplanation(aspects.intellectual)
                },
                physical: {
                    score: aspects.physical,
                    text: getPhysicalText(aspects.physical),
                    scientific: getPhysicalScientificExplanation(aspects.physical)
                },
                spiritual: {
                    score: aspects.spiritual,
                    text: getSpiritualText(aspects.spiritual),
                    scientific: getSpiritualScientificExplanation(aspects.spiritual)
                }
            };

            Object.keys(aspectData).forEach(aspect => {
                const progressBar = document.getElementById(aspect + 'Progress');
                const textElement = document.getElementById(aspect + 'Text');
                
                setTimeout(() => {
                    progressBar.style.width = aspectData[aspect].score + '%';
                    textElement.innerHTML = `
                        <p style="margin-bottom: 10px;">${aspectData[aspect].text}</p>
                        <div class="scientific-explanation">
                            <h5>Scientific Analysis:</h5>
                            <p>${aspectData[aspect].scientific}</p>
                        </div>
                    `;
                }, 500);
            });
        }

        function getEmotionalText(score) {
            if (score >= 80) {
                return 'Strong emotional bond and understanding';
            } else if (score >= 60) {
                return 'Good emotional connection with minor adjustments needed';
            } else if (score >= 40) {
                return 'Moderate emotional compatibility requiring work';
            } else {
                return 'Emotional challenges require significant attention';
            }
        }

        function getEmotionalScientificExplanation(score) {
            if (score >= 80) {
                return "Neurological compatibility indicators suggest synchronized mirror neuron activation, leading to enhanced empathy and emotional resonance. Birth time analysis shows complementary circadian rhythms that support emotional stability.";
            } else if (score >= 60) {
                return "Moderate dopamine-oxytocin response patterns indicate good bonding potential. Geographic birth coordinates suggest complementary energy fields that can enhance emotional connection with conscious effort.";
            } else if (score >= 40) {
                return "Cortisol stress response patterns show some misalignment, requiring mindful communication. Birth location analysis indicates different emotional processing styles that can be bridged through understanding.";
            } else {
                return "Significant differences in neurotransmitter response patterns and emotional processing styles. Geographic energy meridians suggest contrasting emotional needs requiring professional guidance.";
            }
        }

        function getIntellectualText(score) {
            if (score >= 80) {
                return 'Excellent mental stimulation and communication';
            } else if (score >= 60) {
                return 'Good intellectual rapport with shared interests';
            } else if (score >= 40) {
                return 'Average intellectual connection';
            } else {
                return 'Different thinking styles may cause friction';
            }
        }

        function getIntellectualScientificExplanation(score) {
            if (score >= 80) {
                return "Cognitive processing patterns show high synchronization. Birth time analysis indicates complementary left-brain/right-brain dominance, creating optimal intellectual collaboration and mutual learning enhancement.";
            } else if (score >= 60) {
                return "Moderate cognitive resonance with different but complementary thinking styles. Geographic birth influences suggest varied cultural learning patterns that can enrich intellectual exchanges.";
            } else if (score >= 40) {
                return "Some cognitive dissonance in processing styles. Birth coordinate analysis shows different information processing preferences that require patience and active listening techniques.";
            } else {
                return "Significant differences in cognitive architecture and learning styles. Geographic educational influences have created contrasting intellectual approaches requiring bridge-building strategies.";
            }
        }

        function getPhysicalText(score) {
            if (score >= 80) {
                return 'Strong physical attraction and chemistry';
            } else if (score >= 60) {
                return 'Good physical compatibility';
            } else if (score >= 40) {
                return 'Moderate physical connection';
            } else {
                return 'Physical compatibility needs attention';
            }
        }

        function getPhysicalScientificExplanation(score) {
            if (score >= 80) {
                return "Pheromone compatibility analysis shows strong biological attraction markers. Birth time correlation with circadian rhythms suggests synchronized energy levels and natural physical chemistry.";
            } else if (score >= 60) {
                return "Moderate biochemical compatibility with good potential for physical attraction. Geographic birth influences suggest compatible activity preferences and energy patterns.";
            } else if (score >= 40) {
                return "Some biological rhythm misalignment affecting physical compatibility. Birth location analysis indicates different energy expression styles requiring compromise and understanding.";
            } else {
                return "Significant differences in biological rhythms and physical energy patterns. Geographic influences have created contrasting physical preferences requiring conscious attention.";
            }
        }

        function getSpiritualText(score) {
            if (score >= 80) {
                return 'Deep spiritual connection and shared values';
            } else if (score >= 60) {
                return 'Good alignment of life philosophies';
            } else if (score >= 40) {
                return 'Some spiritual compatibility';
            } else {
                return 'Different spiritual paths may create challenges';
            }
        }

        function getSpiritualScientificExplanation(score) {
            if (score >= 80) {
                return "Consciousness frequency analysis shows remarkable alignment. Birth location energy meridians suggest shared spiritual resonance and compatible life purpose directions.";
            } else if (score >= 60) {
                return "Good spiritual compatibility with complementary growth paths. Geographic birth influences indicate shared core values with different expression styles that can mutually enrich spiritual development.";
            } else if (score >= 40) {
                return "Moderate spiritual alignment with some philosophical differences. Birth coordinate analysis suggests different but potentially complementary spiritual learning styles.";
            } else {
                return "Significant differences in spiritual consciousness and life philosophy. Geographic energy influences have created contrasting spiritual paths requiring respectful dialogue and understanding.";
            }
        }

        function calculateVedicScores() {
            return {
                varna: Math.floor(Math.random() * 2),
                vashya: Math.floor(Math.random() * 3),
                tara: Math.floor(Math.random() * 4),
                yoni: Math.floor(Math.random() * 5),
                gana: Math.floor(Math.random() * 7),
                bhakoot: Math.floor(Math.random() * 8),
                nadi: Math.floor(Math.random() * 9),
                rajju: Math.floor(Math.random() * 6)
            };
        }

        function updateVedicScores(scores) {
            const maxScores = {
                varna: 1, vashya: 2, tara: 3, yoni: 4,
                gana: 6, bhakoot: 7, nadi: 8, rajju: 5
            };

            let totalScore = 0;
            Object.keys(scores).forEach(factor => {
                const element = document.getElementById(factor + 'Score');
                element.textContent = scores[factor] + '/' + maxScores[factor];
                totalScore += scores[factor];
            });

            document.getElementById('totalVedicScore').textContent = totalScore + '/36';
        }

        function generatePlanetaryAspects() {
            const aspects = [
                {
                    title: 'Sun-Moon Aspect',
                    description: 'Harmonious blend of conscious and unconscious energies',
                    influence: 'Positive'
                },
                {
                    title: 'Venus-Mars Aspect',
                    description: 'Strong romantic and passionate connection',
                    influence: 'Positive'
                },
                {
                    title: 'Mercury-Jupiter Aspect',
                    description: 'Enhanced communication and wisdom sharing',
                    influence: 'Positive'
                },
                {
                    title: 'Saturn-Ascendant Aspect',
                    description: 'Commitment and long-term stability focus',
                    influence: 'Neutral'
                }
            ];

            const aspectsContainer = document.getElementById('planetaryAspects');
            aspectsContainer.innerHTML = '';

            aspects.forEach(aspect => {
                const aspectElement = document.createElement('div');
                aspectElement.className = 'aspect-item';
                aspectElement.innerHTML = `
                    <h4>${aspect.title} <span style="color: ${aspect.influence === 'Positive' ? '#4CAF50' : '#FFA726'};">(${aspect.influence})</span></h4>
                    <p>${aspect.description}</p>
                `;
                aspectsContainer.appendChild(aspectElement);
            });
        }

        function generateRecommendations(score, aspects) {
            const recommendations = [];
            
            if (score >= 80) {
                recommendations.push('🌟 Excellent compatibility! Focus on maintaining open communication.');
                recommendations.push('💍 Consider deepening your commitment when ready.');
                recommendations.push('🌙 Best times for important decisions: Full moon periods.');
            } else if (score >= 60) {
                recommendations.push('✨ Good compatibility foundation. Work on areas needing attention.');
                recommendations.push('🗣️ Enhanced communication will strengthen your bond.');
                recommendations.push('⏰ Allow time for relationship growth and understanding.');
            } else if (score >= 40) {
                recommendations.push('🔄 Moderate compatibility. Focus on compromise and understanding.');
                recommendations.push('💪 Challenges can be overcome with effort from both sides.');
                recommendations.push('🎯 Work on specific compatibility areas that need improvement.');
            } else {
                recommendations.push('🎗️ Significant challenges require careful consideration.');
                recommendations.push('🤝 Professional relationship counseling may be beneficial.');
                recommendations.push('⚖️ Evaluate if fundamental differences can be resolved.');
            }

            // Add specific recommendations based on lowest scoring aspects
            const aspectScores = Object.entries(aspects).sort((a, b) => a[1] - b[1]);
            
            if (aspectScores[0][1] < 50) {
                const lowestAspect = aspectScores[0][0];
                switch(lowestAspect) {
                    case 'emotional':
                        recommendations.push('❤️ Focus on emotional intimacy and vulnerability sharing.');
                        break;
                    case 'intellectual':
                        recommendations.push('🧠 Engage in more intellectual discussions and shared learning.');
                        break;
                    case 'physical':
                        recommendations.push('💃 Work on physical connection and attraction building.');
                        break;
                    case 'spiritual':
                        recommendations.push('🕯️ Explore spiritual practices or values alignment together.');
                        break;
                }
            }

            // Add relationship-specific recommendations
            switch(selectedRelationshipType) {
                case 'marriage':
                    recommendations.push('💒 Consider pre-marital counseling for best outcomes.');
                    recommendations.push('🏠 Discuss life goals, finances, and family planning.');
                    break;
                case 'dating':
                    recommendations.push('💕 Take time to build a strong foundation before major commitments.');
                    recommendations.push('🎭 Explore different activities together to test compatibility.');
                    break;
                case 'business':
                    recommendations.push('📊 Clearly define roles and responsibilities in partnership.');
                    recommendations.push('💼 Regular business meetings will maintain harmony.');
                    break;
                case 'friendship':
                    recommendations.push('👫 Mutual respect and space will strengthen the friendship.');
                    recommendations.push('🎉 Shared activities and interests will deepen the bond.');
                    break;
            }

            const recommendationsList = document.getElementById('recommendationsList');
            recommendationsList.innerHTML = '';
            
            recommendations.forEach(recommendation => {
                const recElement = document.createElement('div');
                recElement.style.cssText = 'margin-bottom: 10px; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 5px;';
                recElement.innerHTML = `<p>${recommendation}</p>`;
                recommendationsList.appendChild(recElement);
            });
        }

        // Additional utility functions for enhanced analysis
        function getZodiacSign(date) {
            const month = date.getMonth() + 1;
            const day = date.getDate();
            
            if ((month == 3 && day >= 21) || (month == 4 && day <= 19)) return 'Aries';
            if ((month == 4 && day >= 20) || (month == 5 && day <= 20)) return 'Taurus';
            if ((month == 5 && day >= 21) || (month == 6 && day <= 20)) return 'Gemini';
            if ((month == 6 && day >= 21) || (month == 7 && day <= 22)) return 'Cancer';
            if ((month == 7 && day >= 23) || (month == 8 && day <= 22)) return 'Leo';
            if ((month == 8 && day >= 23) || (month == 9 && day <= 22)) return 'Virgo';
            if ((month == 9 && day >= 23) || (month == 10 && day <= 22)) return 'Libra';
            if ((month == 10 && day >= 23) || (month == 11 && day <= 21)) return 'Scorpio';
            if ((month == 11 && day >= 22) || (month == 12 && day <= 21)) return 'Sagittarius';
            if ((month == 12 && day >= 22) || (month == 1 && day <= 19)) return 'Capricorn';
            if ((month == 1 && day >= 20) || (month == 2 && day <= 18)) return 'Aquarius';
            if ((month == 2 && day >= 19) || (month == 3 && day <= 20)) return 'Pisces';
        }

        function simulateSwissEphemeris(birthDate, birthTime, birthPlace) {
            // Simulate Swiss Ephemeris calculations
            // In a real implementation, this would connect to actual ephemeris data
            return {
                sun: Math.floor(Math.random() * 360),
                moon: Math.floor(Math.random() * 360),
                mercury: Math.floor(Math.random() * 360),
                venus: Math.floor(Math.random() * 360),
                mars: Math.floor(Math.random() * 360),
                jupiter: Math.floor(Math.random() * 360),
                saturn: Math.floor(Math.random() * 360),
                rahu: Math.floor(Math.random() * 360),
                ketu: Math.floor(Math.random() * 360),
                ascendant: Math.floor(Math.random() * 360)
            };
        }

        function simulateMLPrediction(person1Data, person2Data, relationshipType) {
            // Simulate ML model prediction
            // In a real implementation, this would call your trained ML model
            const features = [
                person1Data.planetaryPositions,
                person2Data.planetaryPositions,
                relationshipType
            ];
            
            // Simulate model processing
            const baseScore = Math.random() * 100;
            const adjustedScore = baseScore * (0.8 + Math.random() * 0.4);
            
            return {
                overallCompatibility: Math.min(100, adjustedScore),
                emotionalScore: Math.max(0, Math.min(100, adjustedScore + (Math.random() - 0.5) * 30)),
                intellectualScore: Math.max(0, Math.min(100, adjustedScore + (Math.random() - 0.5) * 30)),
                physicalScore: Math.max(0, Math.min(100, adjustedScore + (Math.random() - 0.5) * 30)),
                spiritualScore: Math.max(0, Math.min(100, adjustedScore + (Math.random() - 0.5) * 30)),
                confidence: Math.random() * 0.3 + 0.7
            };
        }

        // Enhanced compatibility calculation with more realistic algorithms
        function enhancedCompatibilityCalculation() {
            const person1Positions = simulateSwissEphemeris(
                new Date(formData.person1.birthdate),
                formData.person1.birthtime,
                formData.person1.birthplace
            );
            
            const person2Positions = simulateSwissEphemeris(
                new Date(formData.person2.birthdate),
                formData.person2.birthtime,
                formData.person2.birthplace
            );
            
            const mlPrediction = simulateMLPrediction(
                { planetaryPositions: person1Positions },
                { planetaryPositions: person2Positions },
                selectedRelationshipType
            );
            
            return mlPrediction;
        }

        // Add smooth animations and transitions
        function addAnimations() {
            const cards = document.querySelectorAll('.analysis-card, .vedic-factor, .aspect-item');
            cards.forEach((card, index) => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(20px)';
                
                setTimeout(() => {
                    card.style.transition = 'all 0.5s ease';
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0)';
                }, index * 100);
            });
        }

        // Initialize tooltips for better user experience
        function initializeTooltips() {
            const tooltipElements = document.querySelectorAll('[data-tooltip]');
            tooltipElements.forEach(element => {
                element.addEventListener('mouseenter', showTooltip);
                element.addEventListener('mouseleave', hideTooltip);
            });
        }

        function showTooltip(event) {
            const tooltip = document.createElement('div');
            tooltip.className = 'tooltip';
            tooltip.textContent = event.target.dataset.tooltip;
            tooltip.style.cssText = `
                position: absolute;
                background: rgba(0,0,0,0.9);
                color: white;
                padding: 8px 12px;
                border-radius: 4px;
                font-size: 14px;
                z-index: 1000;
                pointer-events: none;
                white-space: nowrap;
            `;
            
            document.body.appendChild(tooltip);
            
            const rect = event.target.getBoundingClientRect();
            tooltip.style.left = rect.left + 'px';
            tooltip.style.top = (rect.top - tooltip.offsetHeight - 5) + 'px';
        }

        function hideTooltip() {
            const tooltip = document.querySelector('.tooltip');
            if (tooltip) {
                tooltip.remove();
            }
        }

        // Form validation with visual feedback
        function validateForm() {
            const inputs = document.querySelectorAll('input, select');
            let isValid = true;
            
            inputs.forEach(input => {
                if (input.hasAttribute('required') && !input.value.trim()) {
                    input.style.border = '2px solid #ff4444';
                    isValid = false;
                } else {
                    input.style.border = '';
                }
            });
            
            return isValid;
        }

        // Export functionality for results
        function exportResults() {
            const resultsData = {
                person1: formData.person1,
                person2: formData.person2,
                relationshipType: selectedRelationshipType,
                compatibilityScore: document.getElementById('scoreText').textContent,
                analysisDate: new Date().toISOString(),
                recommendations: Array.from(document.querySelectorAll('#recommendationsList p')).map(p => p.textContent)
            };
            
            const dataStr = JSON.stringify(resultsData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `compatibility_analysis_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Add keyboard shortcuts
        document.addEventListener('keydown', function(event) {
            if (event.ctrlKey && event.key === 'Enter') {
                if (!document.getElementById('analyzeBtn').disabled) {
                    performAnalysis();
                }
            }
            
            if (event.ctrlKey && event.key === 's') {
                event.preventDefault();
                if (document.getElementById('analysisResults').style.display !== 'none') {
                    exportResults();
                }
            }
        });

        // Progress tracking for long calculations
        function updateProgress(percentage, message) {
            const loadingDiv = document.getElementById('loading');
            if (loadingDiv.style.display !== 'none') {
                loadingDiv.innerHTML = `
                    <div class="loading-spinner"></div>
                    <p>${message}</p>
                    <div style="width: 100%; background: rgba(255,255,255,0.2); border-radius: 10px; margin-top: 10px;">
                        <div style="width: ${percentage}%; height: 6px; background: #F5A623; border-radius: 10px; transition: width 0.3s ease;"></div>
                    </div>
                `;
            }
        }

        // Enhanced analysis with progress tracking
        function performEnhancedAnalysis() {
            const resultsDiv = document.getElementById('results');
            const loadingDiv = document.getElementById('loading');
            const analysisDiv = document.getElementById('analysisResults');
            
            resultsDiv.classList.add('show');
            loadingDiv.style.display = 'block';
            analysisDiv.style.display = 'none';
            
            // Simulate detailed analysis steps
            const steps = [
                { progress: 10, message: 'Initializing Swiss Ephemeris calculations...' },
                { progress: 25, message: 'Calculating planetary positions...' },
                { progress: 40, message: 'Running ML compatibility models...' },
                { progress: 60, message: 'Analyzing Vedic compatibility factors...' },
                { progress: 80, message: 'Generating planetary aspects...' },
                { progress: 95, message: 'Compiling recommendations...' },
                { progress: 100, message: 'Analysis complete!' }
            ];
            
            let currentStep = 0;
            const stepInterval = setInterval(() => {
                if (currentStep < steps.length) {
                    updateProgress(steps[currentStep].progress, steps[currentStep].message);
                    currentStep++;
                } else {
                    clearInterval(stepInterval);
                    calculateCompatibility();
                    addAnimations();
                    loadingDiv.style.display = 'none';
                    analysisDiv.style.display = 'block';
                }
            }, 400);
        }

        // Update the analyze button click handler
        document.getElementById('analyzeBtn').addEventListener('click', performEnhancedAnalysis);

        // Add print functionality
        function printResults() {
            const printWindow = window.open('', '', 'width=800,height=600');
            const resultsHTML = document.getElementById('analysisResults').innerHTML;
            
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Compatibility Analysis Results</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        .analysis-card { margin: 15px 0; padding: 15px; border: 1px solid #ddd; }
                        .vedic-factors { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
                        .recommendations { background: #f9f9f9; padding: 15px; margin: 15px 0; }
                        @media print { body { margin: 0; } }
                    </style>
                </head>
                <body>
                    <h1>Advanced Compatibility Analysis Results</h1>
                    <p>Generated on: ${new Date().toLocaleDateString()}</p>
                    ${resultsHTML}
                </body>
                </html>
            `);
            
            printWindow.document.close();
            printWindow.print();
        }

        // Add context menu for additional options
        document.addEventListener('contextmenu', function(event) {
            if (event.target.closest('#analysisResults')) {
                event.preventDefault();
                // Could add custom context menu here
            }
        });

        console.log('Advanced Compatibility Analysis System initialized successfully!');
        console.log('Features: Swiss Ephemeris • ML Predictions • Vedic Kundli Milan • Planetary Aspects');
    </script>
</body>
</html>
            